{"version":3,"file":"ual-anchor.m.js","sources":["../src/AnchorLogo.ts","../src/interfaces.ts","../src/UALAnchorError.ts","../src/AnchorUser.ts","../src/Anchor.ts"],"sourcesContent":["export const AnchorLogo: string = `data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPHN2ZyB3aWR0aD0iMTYwIiBoZWlnaHQ9IjE2MCIgdmlld0JveD0iMCAwIDI1NiAyNTYiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPGcgdHJhbnNmb3JtPSJtYXRyaXgoMS40NCwgMCwgMCwgMS40NCwgLTguNTAxOTI1LCAtNTcuMDc0NTcpIiBzdHlsZT0iIj4KICAgIDx0aXRsZT5XaGl0ZTwvdGl0bGU+CiAgICA8Y2lyY2xlIGN4PSI5NC43OTMiIGN5PSIxMjguNTI0IiByPSI4MCIgZmlsbD0iI0ZCRkRGRiIvPgogICAgPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGQ9Ik0gOTQuNzk5IDc4LjUyNCBDIDk3LjA5OCA3OC41MjQgOTkuMTk1IDc5LjgzNyAxMDAuMTk4IDgxLjkwNiBMIDEyNC4yMDQgMTMxLjQwNiBMIDEyNC43NDYgMTMyLjUyNCBMIDExMS40MDkgMTMyLjUyNCBMIDEwNy41MyAxMjQuNTI0IEwgODIuMDY5IDEyNC41MjQgTCA3OC4xODkgMTMyLjUyNCBMIDY0Ljg1MyAxMzIuNTI0IEwgNjUuMzk1IDEzMS40MDYgTCA4OS40MDEgODEuOTA2IEMgOTAuNDA0IDc5LjgzNyA5Mi41MDEgNzguNTI0IDk0Ljc5OSA3OC41MjQgWiBNIDg2LjkxOSAxMTQuNTI0IEwgMTAyLjY4IDExNC41MjQgTCA5NC43OTkgOTguMjc0IEwgODYuOTE5IDExNC41MjQgWiBNIDExMi43OTMgMTQ5LjUyNCBMIDEyNC43OTggMTQ5LjUyNCBDIDEyNC40MzcgMTY1LjY3NiAxMTEuMDY3IDE3OC41MjQgOTQuNzk5IDE3OC41MjQgQyA3OC41MzIgMTc4LjUyNCA2NS4xNjIgMTY1LjY3NiA2NC44MDEgMTQ5LjUyNCBMIDc2LjgwNiAxNDkuNTI0IEMgNzcuMDg3IDE1Ni44NzggODEuOTc0IDE2My4xNTUgODguNzkzIDE2NS41MiBMIDg4Ljc5MyAxNDEuNTI0IEMgODguNzkzIDEzOC4yMSA5MS40OCAxMzUuNTI0IDk0Ljc5MyAxMzUuNTI0IEMgOTguMTA3IDEzNS41MjQgMTAwLjc5MyAxMzguMjEgMTAwLjc5MyAxNDEuNTI0IEwgMTAwLjc5MyAxNjUuNTI0IEMgMTA3LjYyIDE2My4xNjIgMTEyLjUxMSAxNTYuODgzIDExMi43OTMgMTQ5LjUyNCBaIiBmaWxsPSIjMzY1MEEyIi8+CiAgPC9nPgo8L3N2Zz4=`\r\n","export const Name: string = 'Anchor'\r\n","import { UALError, UALErrorType } from 'universal-authenticator-library'\r\nimport { APIError } from '@greymass/eosio'\r\nimport { Name } from './interfaces'\r\n\r\nexport class UALAnchorError extends UALError {\r\n  constructor(message: string, type: UALErrorType, cause: APIError | null) {\r\n    // Hackery to mimic an eosjs error using @greymass/eosio\r\n    let m = message\r\n    let e:any = new Error(message)\r\n    if (cause) {\r\n      if (cause.details && cause.details[0]) {\r\n        m = cause.details[0].message\r\n        e = new Error(cause.details[0].message)\r\n      }\r\n      e.json = {\r\n        code: 500,\r\n        error: cause.error,\r\n        message: 'Internal Service Error'\r\n      }\r\n    }\r\n    super(m, type, e, Name)\r\n  }\r\n}\r\n","import { SignTransactionResponse, User, UALErrorType } from 'universal-authenticator-library'\r\nimport { APIClient, PackedTransaction, SignedTransaction } from '@greymass/eosio'\r\nimport { JsonRpc } from 'eosjs'\r\nimport { UALAnchorError } from './UALAnchorError'\r\n\r\nexport class AnchorUser extends User {\r\n  public client: APIClient\r\n  public rpc: JsonRpc\r\n  public session: any\r\n\r\n  public signerKey?: string\r\n  public signerProof?: string\r\n  public signerRequest?: any\r\n\r\n  private signatureProvider: any\r\n  private chainId: string\r\n  private accountName: string = ''\r\n  private requestPermission: string = ''\r\n\r\n  constructor(rpc, client, identity) {\r\n    super()\r\n    const { session } = identity\r\n    this.accountName = String(session.auth.actor)\r\n    this.chainId = String(session.chainId)\r\n    if (identity.signatures) {\r\n      [this.signerProof] = identity.signatures\r\n    }\r\n    if (identity.signerKey) {\r\n      this.signerKey = identity.signerKey\r\n    }\r\n    if (identity.resolvedTransaction) {\r\n      this.signerRequest = identity.transaction\r\n    }\r\n    this.requestPermission = String(session.auth.permission)\r\n    this.session = session\r\n    this.client = client\r\n    this.rpc = rpc\r\n  }\r\n\r\n  objectify(data: any) {\r\n    return JSON.parse(JSON.stringify(data))\r\n  }\r\n\r\n  public async signTransaction(transaction, options): Promise<SignTransactionResponse> {\r\n    try {\r\n      const completedTransaction = await this.session.transact(transaction, options)\r\n      const wasBroadcast = (options.broadcast !== false)\r\n      const serializedTransaction = PackedTransaction.fromSigned(SignedTransaction.from(completedTransaction.transaction))\r\n      return this.returnEosjsTransaction(wasBroadcast, {\r\n        ...completedTransaction,\r\n        transaction_id: completedTransaction.payload.tx,\r\n        serializedTransaction: serializedTransaction.packed_trx.array,\r\n        signatures: this.objectify(completedTransaction.signatures),\r\n      })\r\n    } catch (e) {\r\n      const message = 'Unable to sign transaction'\r\n      const type = UALErrorType.Signing\r\n      const cause = e\r\n      throw new UALAnchorError(message, type, cause)\r\n    }\r\n  }\r\n\r\n  public async signArbitrary(publicKey: string, data: string, _: string): Promise<string> {\r\n    throw new UALAnchorError(\r\n      `Anchor does not currently support signArbitrary(${publicKey}, ${data})`,\r\n      UALErrorType.Unsupported,\r\n      null)\r\n  }\r\n\r\n  public async verifyKeyOwnership(challenge: string): Promise<boolean> {\r\n    throw new UALAnchorError(\r\n      `Anchor does not currently support verifyKeyOwnership(${challenge})`,\r\n      UALErrorType.Unsupported,\r\n      null)\r\n  }\r\n\r\n  public async getAccountName() {\r\n    return this.accountName\r\n  }\r\n\r\n  public async getChainId() {\r\n    return this.chainId\r\n  }\r\n\r\n  public async getKeys() {\r\n    try {\r\n      const keys = await this.signatureProvider.getAvailableKeys(this.requestPermission)\r\n      return keys\r\n    } catch (error) {\r\n      const message = `Unable to getKeys for account ${this.accountName}.\r\n        Please make sure your wallet is running.`\r\n      const type = UALErrorType.DataRequest\r\n      const cause = error\r\n      throw new UALAnchorError(message, type, cause)\r\n    }\r\n  }\r\n\r\n  public async isAccountValid() {\r\n    try {\r\n      const account = this.client && await this.client.v1.chain.get_account(this.accountName)\r\n      const actualKeys = this.extractAccountKeys(account)\r\n      const authorizationKeys = await this.getKeys()\r\n\r\n      return actualKeys.filter((key) => {\r\n        return authorizationKeys.indexOf(key) !== -1\r\n      }).length > 0\r\n    } catch (e) {\r\n      if (e.constructor.name === 'UALAnchorError') {\r\n        throw e\r\n      }\r\n\r\n      const message = `Account validation failed for account ${this.accountName}.`\r\n      const type = UALErrorType.Validation\r\n      const cause = e\r\n      throw new UALAnchorError(message, type, cause)\r\n    }\r\n  }\r\n\r\n  public extractAccountKeys(account) {\r\n    const keySubsets = account.permissions.map((permission) => permission.required_auth.keys.map((key) => key.key))\r\n    let keys = []\r\n    for (const keySubset of keySubsets) {\r\n      keys = keys.concat(keySubset)\r\n    }\r\n    return keys\r\n  }\r\n}\r\n","import { APIClient, FetchProvider } from '@greymass/eosio'\r\nimport {\r\n  Authenticator,\r\n  ButtonStyle,\r\n  Chain,\r\n  UALError,\r\n  UALErrorType,\r\n  User\r\n} from 'universal-authenticator-library'\r\n\r\nimport { AnchorLogo } from './AnchorLogo'\r\nimport { AnchorUser } from './AnchorUser'\r\nimport { JsonRpc } from 'eosjs'\r\nimport { Name } from './interfaces'\r\nimport { UALAnchorError } from './UALAnchorError'\r\n\r\ndeclare var AnchorLink: any;\r\ndeclare var AnchorLinkBrowserTransport: any;\r\n\r\nexport interface UALAnchorOptions {\r\n  // The app name, required by anchor-link. Short string identifying the app\r\n  appName: string\r\n  // A APIClient object from @greymass/eosio. If not specified, it'll be created using the JsonRpc endpoint\r\n  client?: APIClient\r\n  // Either a JsonRpc instance from eosjs or the url for an API to connect a new JsonRpc instance to\r\n  rpc?: JsonRpc\r\n  // The callback service URL to use, defaults to https://cb.anchor.link\r\n  service?: string\r\n  // A flag to disable the Greymass Fuel integration, defaults to false (enabled)\r\n  disableGreymassFuel?: boolean\r\n  // A flag to enable the Anchor Link UI request status, defaults to false (disabled)\r\n  requestStatus?: boolean\r\n  // An account name to use as the referral account for Fuel\r\n  fuelReferrer?: string\r\n  // Whether anchor-link should be configured to verify identity proofs in the browser for the app\r\n  verifyProofs?: boolean\r\n}\r\n\r\nexport class Anchor extends Authenticator {\r\n  // a JsonRpc instance that can be utilized\r\n  public rpc: JsonRpc\r\n  // a APIClient instance that can be utilized\r\n  public client: APIClient\r\n  // Storage for AnchorUser instances\r\n  private users: AnchorUser[] = []\r\n  // The app name, required by anchor-link\r\n  private appName: string\r\n  // storage for the anchor-link instance\r\n  private link?: any\r\n  // the callback service url, defaults to https://cb.anchor.link\r\n  private service: string = 'https://cb.anchor.link'\r\n  // the chainId currently in use\r\n  private chainId: string\r\n  // disable Greymass Fuel cosigning, defaults to false\r\n  private disableGreymassFuel: boolean = false\r\n  // display the request status returned by anchor-link, defaults to false (ual has it's own)\r\n  private requestStatus: boolean = false\r\n  // The referral account used in Fuel transactions\r\n  private fuelReferrer: string = 'teamgreymass'\r\n  // Whether anchor-link should be configured to verify identity proofs in the browser for the app\r\n  private verifyProofs: boolean = false\r\n\r\n  /**\r\n   * Anchor Constructor.\r\n   *\r\n   * @param chains\r\n   * @param options { appName } appName is a required option to use Scatter\r\n   */\r\n  constructor(chains: Chain[], options?: UALAnchorOptions) {\r\n    super(chains)\r\n    // Establish initial values\r\n    this.chainId = chains[0].chainId\r\n    this.users = []\r\n    // Determine the default rpc endpoint for this chain\r\n    const [chain] = chains\r\n    const [rpc] = chain.rpcEndpoints\r\n    // Ensure the appName is set properly\r\n    if (options && options.appName) {\r\n      this.appName = options.appName\r\n    } else {\r\n      throw new UALAnchorError('ual-anchor requires the appName property to be set on the `options` argument during initialization.',\r\n        UALErrorType.Initialization,\r\n        null)\r\n    }\r\n    // Allow overriding the JsonRpc client via options\r\n    if (options && options.rpc) {\r\n      this.rpc = options.rpc\r\n    } else {\r\n      // otherwise just return a generic rpc instance for this endpoint\r\n      this.rpc = new JsonRpc(`${rpc.protocol}://${rpc.host}:${rpc.port}`)\r\n    }\r\n    // Allow overriding the APIClient via options\r\n    if (options && options.client) {\r\n      this.client = options.client\r\n    } else {\r\n      const provider = new FetchProvider(`${rpc.protocol}://${rpc.host}:${rpc.port}`)\r\n      this.client = new APIClient({ provider })\r\n    }\r\n    // Allow passing a custom service URL to process callbacks\r\n    if (options.service) {\r\n      this.service = options.service\r\n    }\r\n    // Allow passing of disable flag for Greymass Fuel\r\n    if (options && options.disableGreymassFuel) {\r\n      this.disableGreymassFuel = options.disableGreymassFuel\r\n    }\r\n    // Allow passing of disable flag for resulting request status\r\n    if (options && options.requestStatus) {\r\n      this.requestStatus = options.requestStatus\r\n    }\r\n    // Allow specifying a Fuel referral account\r\n    if (options && options.fuelReferrer) {\r\n      this.fuelReferrer = options.fuelReferrer\r\n    }\r\n    // Allow overriding the proof verification option\r\n    if (options && options.verifyProofs) {\r\n      this.verifyProofs = options.verifyProofs\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Called after `shouldRender` and should be used to handle any async actions required to initialize the authenticator\r\n   */\r\n  public async init() {\r\n    // establish anchor-link\r\n    this.link = new AnchorLink({\r\n      chains: [{\r\n        chainId: this.chainId,\r\n        nodeUrl: this.client,\r\n      }],\r\n      service: this.service,\r\n      transport: new AnchorLinkBrowserTransport({\r\n        requestStatus: this.requestStatus,\r\n        disableGreymassFuel: this.disableGreymassFuel,\r\n        fuelReferrer: this.fuelReferrer,\r\n      }),\r\n      verifyProofs: this.verifyProofs,\r\n    })\r\n    // attempt to restore any existing session for this app\r\n    const session = await this.link.restoreSession(this.appName)\r\n    if (session) {\r\n      this.users = [new AnchorUser(this.rpc, this.client, { session })]\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resets the authenticator to its initial, default state then calls `init` method\r\n   */\r\n  public reset() {\r\n    this.users = []\r\n  }\r\n\r\n  /**\r\n   * Returns true if the authenticator has errored while initializing.\r\n   */\r\n  public isErrored() {\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * Returns a URL where the user can download and install the underlying authenticator\r\n   * if it is not found by the UAL Authenticator.\r\n   */\r\n  public getOnboardingLink(): string {\r\n    return 'https://github.com/greymass/anchor/'\r\n  }\r\n\r\n  /**\r\n   * Returns error (if available) if the authenticator has errored while initializing.\r\n   */\r\n  public getError(): UALError | null {\r\n    return null\r\n  }\r\n\r\n  /**\r\n   * Returns true if the authenticator is loading while initializing its internal state.\r\n   */\r\n  public isLoading() {\r\n    return false\r\n  }\r\n\r\n  public getName() {\r\n    return 'anchor'\r\n  }\r\n\r\n  /**\r\n   * Returns the style of the Button that will be rendered.\r\n   */\r\n  public getStyle(): ButtonStyle {\r\n    return {\r\n      icon: AnchorLogo,\r\n      text: Name,\r\n      textColor: 'white',\r\n      background: '#3650A2'\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the button should render based on the operating environment and other factors.\r\n   * ie. If your Authenticator App does not support mobile, it returns false when running in a mobile browser.\r\n   */\r\n  public shouldRender() {\r\n    return !this.isLoading()\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the dapp should attempt to auto login with the Authenticator app.\r\n   * Auto login will only occur when there is only one Authenticator that returns shouldRender() true and\r\n   * shouldAutoLogin() true.\r\n   */\r\n  public shouldAutoLogin() {\r\n    return this.users.length > 0\r\n  }\r\n\r\n  /**\r\n   * Returns whether or not the button should show an account name input field.\r\n   * This is for Authenticators that do not have a concept of account names.\r\n   */\r\n  public async shouldRequestAccountName(): Promise<boolean> {\r\n    return false\r\n  }\r\n\r\n  /**\r\n   * Login using the Authenticator App. This can return one or more users depending on multiple chain support.\r\n   *\r\n   * @param accountName  The account name of the user for Authenticators that do not store accounts (optional)\r\n   */\r\n  public async login(): Promise<User[]> {\r\n    if (this.chains.length > 1) {\r\n      throw new UALAnchorError('UAL-Anchor does not yet support providing multiple chains to UAL. Please initialize the UAL provider with a single chain.',\r\n        UALErrorType.Unsupported,\r\n        null)\r\n    }\r\n    try {\r\n      // only call the login method if no users exist, to prevent UI from prompting for login during auto login\r\n      //  some changes to UAL are going to be required to support multiple users\r\n      if (this.users.length === 0) {\r\n        const identity = await this.link.login(this.appName)\r\n        this.users = [new AnchorUser(this.rpc, this.client, identity)]\r\n      }\r\n    } catch (e) {\r\n      throw new UALAnchorError(\r\n        e.message,\r\n        UALErrorType.Login,\r\n        e)\r\n    }\r\n    return this.users\r\n  }\r\n\r\n  /**\r\n   * Logs the user out of the dapp. This will be strongly dependent on each Authenticator app's patterns.\r\n   */\r\n  public async logout(): Promise<void>  {\r\n    // Ensure a user exists to logout\r\n    if (this.users.length) {\r\n        // retrieve the current user\r\n        const [user] = this.users\r\n        // retrieve the auth from the current user\r\n        const { session: { auth } } = user\r\n        // remove the session from anchor-link\r\n        await this.link.removeSession(this.appName, auth, this.chainId)\r\n    }\r\n    // reset the authenticator\r\n    this.reset()\r\n  }\r\n\r\n  /**\r\n   * Returns true if user confirmation is required for `getKeys`\r\n   */\r\n  public requiresGetKeyConfirmation(): boolean {\r\n    return false\r\n  }\r\n}\r\n"],"names":[],"mappings":"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"}